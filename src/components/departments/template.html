<pbx-loader *ngIf="loading"></pbx-loader>
<div class="departments" *ngIf="!loading">

    <pbx-list style="width: 100%"
              [(pageInfo)]="pageInfo"
              [table]="table"
              [loading]="loading"
              [filters]="filters"
              key="departments"
              name="Departments"
              itemName="Department"
              [EmptyInfo]="companyActive ? null : 'Please fill company info first.'"
              [buttons]="buttons"
              (onCreate)="create()"
              (onEdit)="edit($event)"
              (onSelect)="select($event)"
              [service]="service">
    </pbx-list>
</div>
<pbx-sidebar *ngIf="sidebar.visible">
    <pbx-loader *ngIf="sidebar.loading"></pbx-loader>
    <ng-container *ngIf="!sidebar.loading && sidebar.mode === 'edit'">
        <form class="sidebar_form" [formGroup]="departmentForm">

            <pbx-input name="Department"
                       key="name"
                       labelPosition="top"
                       [form]="true"
                       [singleBorder]="false"
                       [floatError]="true"
                       [object]="departmentForm"
            ></pbx-input>

            <div class="sidebar_row select_row">
                <div formArrayName="sipInner" class="sidebar_row unmargin">
                    <div class="sidebar_row_select"
                         *ngFor="let sip of departmentForm.get('sipInner')['controls']; let i=index"
                         [formGroupName]="i">

                        <pbx-input name="Department Phone"
                                   displayKey="phoneNumber"
                                   formKey="sipInner"
                                   labelPosition="top"
                                   [options]="getSelectNumbers()"
                                   [singleBorder]="false"
                                   [index2]="i"
                                   [form]="true"
                                   [floatError]="true"
                                   [object]="departmentForm"
                                   [objectView]="selectedSips[i]"
                                   (onSelect)="selectPhone($event, i)"
                        >
                            <div class="icon_wrap" (click)="addPhone(i)">
                                <svg-icon src="../../assets/icons/plus_13px.svg"></svg-icon>
                            </div>
                        </pbx-input>

                        <!--<pbx-select [options]="getSelectNumbers()"-->
                                    <!--[selected]="selectedSips[i]"-->
                                    <!--[objectKey]="'phoneNumber'"-->
                                    <!--(onSelect)="selectPhone($event, i)"></pbx-select>-->
                        <!--<svg-icon src="../../assets/icons/plus_13px.svg" (click)="addPhone()"></svg-icon>-->
                    </div>
                </div>
            </div>

            <pbx-input name="Comment"
                       key="comment"
                       labelPosition="top"
                       type="textarea"
                       [form]="true"
                       [singleBorder]="false"
                       [floatError]="true"
                       [object]="departmentForm"
            ></pbx-input>

        </form>
        <div class="sidebar_controls">
            <pbx-button [value]="'Cancel'" [buttonType]="'cancel'" (onClick)="close()"></pbx-button>
            <pbx-button [value]="'Save'" [buttonType]="'success'" (onClick)="save()"></pbx-button>
        </div>
    </ng-container>
    <ng-container *ngIf="!sidebar.loading && sidebar.mode === 'view'">
        <div class="sidebar_info">
            <div class="sidebar_row">
                <label>Department</label>
                <p>{{selected.name}}</p>
            </div>
            <div class="sidebar_row">
                <label>Department Phones</label>
                <p *ngFor="let phone of getPhonesCurrentDepartment(selected)">{{phone}}</p>
            </div>
            <div class="sidebar_row">
                <label>Comment</label>
                <p>{{selected.comment}}</p>
            </div>
            <div class="sidebar_row" (click)="list.items.clickDeleteItem(selected)">
                <span>Delete Department</span>
            </div>
        </div>
        <div class="sidebar_controls">
            <pbx-button [value]="'Close'" [buttonType]="'cancel'" (onClick)="close()"></pbx-button>
            <pbx-button [value]="'Edit'" [buttonType]="'success'" (onClick)="edit(selected)"></pbx-button>
        </div>
    </ng-container>
</pbx-sidebar>
