<pbx-loader *ngIf="loading"></pbx-loader>
<div class="departments" *ngIf="!loading">

    <pbx-list style="width: 100%"
              [(pageInfo)]="pageInfo"
              [table]="table"
              [loading]="loading"
              [filters]="filters"
              key="departments"
              name="Departments"
              itemName="Department"
              buttonTitle="Add Department"
              (onCreate)="create()"
              (onEdit)="edit($event)"
              (onSelect)="select($event)"
              [service]="service">
    </pbx-list>
</div>
<pbx-sidebar *ngIf="sidebar.visible">
    <pbx-loader *ngIf="sidebar.loading"></pbx-loader>
    <ng-container *ngIf="!sidebar.loading && sidebar.mode === 'edit'">
        <form class="sidebar_form" [formGroup]="departmentForm">
            <div class="sidebar_row">
                <label for="department">Department</label>
                <input type="text" id="department" formControlName="name" autofocus>
            </div>
            <div class="sidebar_row select_row">
                <label for="comment">Department Phone</label>
                <div formArrayName="sipInner" class="sidebar_row unmargin">
                    <div class="sidebar_row_select"
                         *ngFor="let sip of departmentForm.get('sipInner')['controls']; let i=index"
                         [formGroupName]="i">
                        <pbx-select [options]="getSelectNumbers()"
                                    [selected]="selectedSips[i]"
                                    [objectKey]="'phoneNumber'"
                                    (onSelect)="selectPhone($event, i)"></pbx-select>
                        <svg-icon src="../../assets/icons/plus_13px.svg" (click)="addPhone()"></svg-icon>
                    </div>
                </div>
            </div>
            <div class="sidebar_row">
                <label for="comment">Comment</label>
                <textarea id="comment" rows="5" formControlName="comment"></textarea>
            </div>
        </form>
        <div class="sidebar_controls">
            <pbx-button [value]="'Cancel'" [buttonType]="'cancel'" (onClick)="close()"></pbx-button>
            <pbx-button [value]="'Save'" [buttonType]="'success'" (onClick)="save()"></pbx-button>
        </div>
    </ng-container>
    <ng-container *ngIf="!sidebar.loading && sidebar.mode === 'view'">
        <div class="sidebar_info">
            <div class="sidebar_row">
                <label for="department">Department</label>
                <p>{{selected.name}}</p>
            </div>
            <div class="sidebar_row">
                <label>Department Phones</label>
                <p *ngFor="let phone of getPhonesCurrentDepartment(selected)">{{phone}}</p>
            </div>
            <div class="sidebar_row">
                <label>Comment</label>
                <p>{{selected.comment}}</p>
            </div>
            <div class="sidebar_row" (click)="list.items.clickDeleteItem(selected)">
                <span>Delete Department</span>
            </div>
        </div>
        <div class="sidebar_controls">
            <pbx-button [value]="'Close'" [buttonType]="'cancel'" (onClick)="close()"></pbx-button>
            <pbx-button [value]="'Edit'" [buttonType]="'success'" (onClick)="edit(selected)"></pbx-button>
        </div>
    </ng-container>
</pbx-sidebar>
